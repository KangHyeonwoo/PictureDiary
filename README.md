# PictureDiary

저장소(현재는 NAS)에 저장된 사진 데이터를 사용자에 따라 조회해 맵에 표출해주는 프로젝트

- 데이터 조회
- 메타데이터 수정
- 삭제
- 로컬에서 나스로 사진 추가 (TODO)
- Admin 은 사용자 관리만 할 수 있는 계정 (TODO)

의 기능이 있다.

## 프로젝트 진행하면서 공부할 기능들

- Database : PostgreSQL
- Docker Container 위에 서비스 올리기
- @Valid 및 Validation 자동화
- ResponseEntity
- 캐싱 (우선은 맵으로 구현하고 Spring Cache 적용 방안 고려 + 리팩토링 진행하고 흔적 정리하기)
- 파일 썸네일 가져올 때는 용량 축소해서 가져오기
- HEIC 확장자 방안 고려
- 카카오맵 사용
- 지도에서 사용할 마커 및 인포윈도우는 class 객체로 관리하기 (javascript es6 문법 공부하면서 하자)

## 개발 방향 정리

> 원본 파일은 건드리지 않음을 원칙으로 한다.

### 로그인 후 저장소에서 데이터 조회

1. 캐싱된 데이터를 조회
   - 캐싱은 Map 객체로 관리하며 (HashMap vs LinkedHashMap) Map<UserId, List<PictureDto>> 의 형태로 관리
2. 캐싱된 데이터가 있으면 캐싱된 데이터를 리턴하고, 없으면 DB 에서 조회한다.
3. DB 에 조회된 데이터를 캐싱하고 리턴한다. (deleteAt = N 인 것들만)
4. 조회된 데이터를 화면에 뿌리고, 비동기로 최신화된 데이터를 조회한다.
   - 비동기 작업은 알림으로 알려주며, 진행 상황도 같이 알려줄 수 있는 방안을 고려한다.
5. DB 에서 모든 데이터를 조회한다.
6. NAS 에 저장된 모든 데이터를 조회한다.
7. NAS 에는 있고 DB 에는 없는 데이터를 추린다. (최신화된 데이터)
   - 두 배열의 값을 비교하는 방법 있는지 찾아보기
8. NAS 에만 있는 데이터를 DB 에 저장하고 캐싱하고 리턴한다.
9. 화면에 최신화 작업이 완료됐다는 토스트창을 띄우고 화면에 새로운 데이터들을 추가한다.

### 메타데이터 수정

1. 저장소의 원본 파일을 백업한다.
   - 수정하려는 파일이 이미 백업 파일인 경우에는 1번 패스
2. 백업본의 메타데이터를 수정한다.
3. 수정된 파일의 정보를 다시 조회한다.
4. 조회한 정보를 DB 에 업데이트한다.

> **고려사항**
> 
> 백업 성공 -> 메타데이터 수정 -> DB 업데이트를 하나의 트랜잭션으로 간주한다.
> 중간에 에러가 났을 경우 전부 롤백할 수 있는 방안을 고려한다.

### 파일 삭제

1. deleteAt 컬럼을 Y 로.
2. 화면에서는 마커 지우기

### 기타 메모

- 프론트엔드에 시간을 너무 많이 소요해, 효율적인 시간 분배를 못했음
  - 프론트엔드 특히 CSS에 투자하는 시간을 줄이기 위해 화면 구성은 최소한으로.
    (그래도 결과물은 나와야하니 최소한은 하기)

- 테스트는 로컬 디렉토리로 한다.
- 로컬에서도 잘 할 수 있도록 (변화를 주어도 소스코드의 수정을 최소화할 수 있도록) 구현하자.
- TDD 로 구현

- 캐싱을 통한 새로고침 고려
- 메소드 주석 잘 달기
- 세션 타임아웃 설정하기
- 마커에 붙어있는 썸네일은 적은 용량으로 사진을 조회해야 한다.
- HEIC 이놈이 제일 문제.